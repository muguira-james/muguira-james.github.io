<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"muguira-james.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Use node Express to serve a React app">
<meta property="og:type" content="article">
<meta property="og:title" content="Using Express to serve a React app">
<meta property="og:url" content="http://muguira-james.github.io/2018/10/26/2018-10-25-Using-Express-to-serve-a-React-JS-app/index.html">
<meta property="og:site_name" content="My musing">
<meta property="og:description" content="Use node Express to serve a React app">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://muguira-james.github.io/images/ProdReact.png">
<meta property="article:published_time" content="2018-10-26T17:27:12.000Z">
<meta property="article:modified_time" content="2022-01-26T02:24:54.559Z">
<meta property="article:author" content="James Muguira">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Node">
<meta property="article:tag" content="Express">
<meta property="article:tag" content="MongoDB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://muguira-james.github.io/images/ProdReact.png">


<link rel="canonical" href="http://muguira-james.github.io/2018/10/26/2018-10-25-Using-Express-to-serve-a-React-JS-app/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://muguira-james.github.io/2018/10/26/2018-10-25-Using-Express-to-serve-a-React-JS-app/","path":"2018/10/26/2018-10-25-Using-Express-to-serve-a-React-JS-app/","title":"Using Express to serve a React app"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Using Express to serve a React app | My musing</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">My musing</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">A place to write and describe</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Setup-Node-and-Express"><span class="nav-number">1.1.</span> <span class="nav-text">Setup Node and Express</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#First-server"><span class="nav-number">1.2.</span> <span class="nav-text">First server</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Setup-Express-for-serving-static-content"><span class="nav-number">1.2.1.</span> <span class="nav-text">Setup Express for serving static content</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Our-Second-Server"><span class="nav-number">1.3.</span> <span class="nav-text">Our Second Server</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Cross-Origin-Support-CORS"><span class="nav-number">1.3.1.</span> <span class="nav-text">Cross Origin Support (CORS)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conclusion"><span class="nav-number">2.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">James Muguira</p>
  <div class="site-description" itemprop="description">I write about technology mostly</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://muguira-james.github.io/2018/10/26/2018-10-25-Using-Express-to-serve-a-React-JS-app/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="James Muguira">
      <meta itemprop="description" content="I write about technology mostly">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My musing">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Using Express to serve a React app
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-10-26 13:27:12" itemprop="dateCreated datePublished" datetime="2018-10-26T13:27:12-04:00">2018-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-25 21:24:54" itemprop="dateModified" datetime="2022-01-25T21:24:54-05:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Use node Express to serve a React app</p>
<span id="more"></span>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>This article will describe how to setup node express to serve a React app.  We will reuse the React app created for the article <a target="_blank" rel="noopener" href="https://github.com/muguira-james/toysoldiergolf">Creating a basic React map with Leaflet</a>.  The code for this article is <a target="_blank" rel="noopener" href="https://github.com/muguira-james/React-Express">here</a>. The article has several parts: </p>
<ul>
<li>Getting a simple express server working on your computer</li>
<li>Enhancing the React App to fetch data from a server</li>
</ul>
<p>There are many tutorials on the web that describe the process of creating a React app.  There are also numerous articles that walk through creating apps with Express. The main contribution here will be demonstrating how to go from development to production with an existing React app.  The production version of the React app will be served by Express.</p>
<h2 id="Setup-Node-and-Express"><a href="#Setup-Node-and-Express" class="headerlink" title="Setup Node and Express"></a>Setup Node and Express</h2><p>I advise you use Mozilla’s great material to install Node <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs">Mozilla MDM</a>.  I also advise you to follow the instructions for obtaining Node from the Node website.  You could use the package manager for your distribution or Brew for the Mac.  However, getting your code directly from the source is best.  Once nodeJS is installed installing Express is simply: “npm install express -g”</p>
<p>This article will build a couple of versions of the server. I’ll do this to show how simple it is to use Express. The first version will just start a server and serve the React app as a static page.  We’ll then add features to that version: very simple routing and a very simple DB.</p>
<h2 id="First-server"><a href="#First-server" class="headerlink" title="First server"></a>First server</h2><p>Using node + Express can be very simple.  Make a directory called simple_express and use “cd simple_express; npm init”. Then add this 4-line program as simple_press.js:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;)</span><br><span class="line">var app = express()</span><br><span class="line">var port = 9000</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, (request, response) =&gt; &#123;</span><br><span class="line">    response.send(&quot;hello World&quot;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(port, () =&gt; &#123;</span><br><span class="line">    console.log(`app listening on port $&#123;port&#125;`)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>The first 2 lines pull in express (after you install it with npm install express -g) and create a variable to hold the reference.  The statement “app.get” sets up a route or a way to translate the url into something the server can return to the caller.  In this case, the browser url would be “<a target="_blank" rel="noopener" href="http://localhost:9000/&quot;">http://localhost:9000/&quot;</a> and the server would return “hello world” as a string.  Express handles all setting of the headers.  We’ll do more with that in a bit. The last statement (“app.listen”) starts the server and waits on input from localhost port 9000.  If you point your server to localhost:9000 you should get “hello world” back.</p>
<p>At this point we could create complex html pages and serve them by adding more modules to Express.  But the article goal is to serve a React app.  How to do that?</p>
<p>A React app created from the create-react-app command provides a number of “canned” scripts.  For example, we can start the app and show it in the default browser (npm start), we start the Jest test fixture (npm test) and we can have the built-in webpack bundle together our app in a build directory.  This bundled app will have the javascript code joined into a single file (or maybe 2 files, depending on your setup - we do a directory listing down below).  It will have all of the paths setup to run from a static path and the package.json file adjusted to run from a relative url.  Thus, the app is bundled together as a static uri resource.</p>
<p>This article will reuse the React app we wrote to use Leaflet in React <a href="https://muguira-james.github.io/A-creating-basic-React-app-with-a-leaflet-map/">React + Leaflet</a>. Issuing “npm start” from the command line can run the code.  It opens port 3000 on localhost.  Fro the browser point of view, the React app is just static content.  It is html and javascript and images.  So, we want Express to treat the React app as static content when a client requests the React App. However, the React app is setup to run from the create-react-app infrastructure.  We need to convert it to a static format for serving from our Express server.  To accomplish this we use “npm run build”.  That command will create a build dir and add all of the required content.  We can copy the contents of the build dir to our Express server “public”.  We are going to run the build step manually, but you might want to look into Jenkins to handle it automatically.</p>
<h3 id="Setup-Express-for-serving-static-content"><a href="#Setup-Express-for-serving-static-content" class="headerlink" title="Setup Express for serving static content"></a>Setup Express for serving static content</h3><p>The first thing we need to do is to tell Express how to serve static content, such as index.html files and images.  When you work with Express you have the ability to extend it by adding “middle-ware” that helps with adding functionality.  We are going to take advantage of a middle-ware that let’s Express serve static information.  It is a single line that we add right before we setup our route:</p>
<ul>
<li>app.use(express.static(‘public’))</li>
</ul>
<p>In Express, adding middle-ware happens “in order” and BEFORE you add routes and start the server.  In our case we will add a middle-ware to handle static content.  We’ll point to the “public” directory and store all of our React bundled software there. The server now looks like:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;)</span><br><span class="line">var app = express()</span><br><span class="line"></span><br><span class="line">app.use(express.static(&#x27;public&#x27;))</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, (request, response) =&gt; &#123;</span><br><span class="line">    response.send(&quot;hello World&quot;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(3000, () =&gt; &#123;</span><br><span class="line">    console.log(&#x27; app listening on port 3000&#x27;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>After we copy all of our bundled React app, from the build directory into the Express “public” directoy, our structure for the project looks like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">asset-manifest.json	favicon.ico		index.html		manifest.json		service-worker.js	static</span><br><span class="line"></span><br><span class="line">public//static:</span><br><span class="line">css	js	media</span><br><span class="line"></span><br><span class="line">public//static/css:</span><br><span class="line">main.65027555.css	main.65027555.css.map</span><br><span class="line"></span><br><span class="line">public//static/js:</span><br><span class="line">main.c70caac9.js	main.c70caac9.js.map</span><br><span class="line"></span><br><span class="line">public//static/media:</span><br><span class="line">Hole1.813cb29b.png	...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Inspecting this you can see: a css, js and media directories under public. The “npm build” command gathered up all of the javascript, our source and the modules under node_modules and put them into the “public/static/js” dir. Since the React app has several image files they are saved into “public/static/media”. If we run the server and point our browser at localhost:9000/index.html we see the following:</p>
<p><img src="/images/ProdReact.png" alt="ProdReact.png"></p>
<h2 id="Our-Second-Server"><a href="#Our-Second-Server" class="headerlink" title="Our Second Server"></a>Our Second Server</h2><p>We have created enough infrastructure to serve a static React app.  Express is using the static middle-ware to serve our React App. But, the data for the React app is defined in the React program.  Now, let’s define it in the server and have the React App fetch it.</p>
<p>The first change is to define the server API in our server for the React app.  We can take the data out of the React app and place it in the server.  This will form a simple in-memory db.  Then we define the API using Express routes.  </p>
<h3 id="Cross-Origin-Support-CORS"><a href="#Cross-Origin-Support-CORS" class="headerlink" title="Cross Origin Support (CORS)"></a>Cross Origin Support (CORS)</h3><p>If you look at the code for the server you will see 2 new items: CORS support and the data for the list players.  If you study the urls and ports in our application you will notice that we were careful to serve the React App from localhost on port 9000.  We were also careful to have the React App request data from localhost port 9000.  We defined a new API for the React App to get the data from: /api/players.  These definitions do not violate Cross Origin Resource Support, or CORS, rules.  </p>
<p>A lot happens behind the scenes when a browser asks for a web page.  When a browser first asks for a web page it sends a small message to the server called a “pre-flight message”.  The web server checks this message, specifically the headers, to see if the requesting host and ports match its own.  If they do, the web server sends back a positive acknowledgement to the requesting client and the browser continuous to load the requested page.  If not the web server checks to see if it has had CORS enabled.  If this is true, it will send back a positive acknowledgement anyway to let the browser proceed.  If CORS is not enabled the server sends back a negative acknowledgement and the browser reports the error in the console.</p>
<p>We can test this out in our current setup.  Here is the full server code so far</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> port = <span class="number">9000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// as you can see from this structure the players are on hole &#123;1, 2, 3, 4&#125;</span></span><br><span class="line"><span class="keyword">const</span> players = &#123;</span><br><span class="line">    <span class="attr">graph</span>: [</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Joan&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Jet&quot;</span>, <span class="attr">ID</span>: <span class="number">1</span>, <span class="attr">Hole</span>: <span class="number">1</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;TEE&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Ruth&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Crist&quot;</span>, <span class="attr">ID</span>: <span class="number">2</span>, <span class="attr">Hole</span>: <span class="number">1</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;TEE&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Beth&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Flick&quot;</span>, <span class="attr">ID</span>: <span class="number">3</span>, <span class="attr">Hole</span>: <span class="number">1</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;TEE&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Julie&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Ant&quot;</span>, <span class="attr">ID</span>: <span class="number">4</span>, <span class="attr">Hole</span>: <span class="number">1</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;FWY&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Ginny&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Grey&quot;</span>, <span class="attr">ID</span>: <span class="number">5</span>, <span class="attr">Hole</span>: <span class="number">1</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;FWY&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Paula&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Lamb&quot;</span>, <span class="attr">ID</span>: <span class="number">6</span>, <span class="attr">Hole</span>: <span class="number">1</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;GRN&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Ingid&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Jones&quot;</span>, <span class="attr">ID</span>: <span class="number">7</span>, <span class="attr">Hole</span>: <span class="number">2</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;TEE&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Kelly&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Smith&quot;</span>, <span class="attr">ID</span>: <span class="number">8</span>, <span class="attr">Hole</span>: <span class="number">2</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;FWY&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Eilean&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Rams&quot;</span>, <span class="attr">ID</span>: <span class="number">9</span>, <span class="attr">Hole</span>: <span class="number">2</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;GRN&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Barb&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Sharp&quot;</span>, <span class="attr">ID</span>: <span class="number">10</span>, <span class="attr">Hole</span>: <span class="number">4</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;FWY&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Carol&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Adams&quot;</span>, <span class="attr">ID</span>: <span class="number">11</span>, <span class="attr">Hole</span>: <span class="number">4</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;FWY&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">FirstName</span>: <span class="string">&quot;Faith&quot;</span>, <span class="attr">LastName</span>: <span class="string">&quot;Hope&quot;</span>, <span class="attr">ID</span>: <span class="number">12</span>, <span class="attr">Hole</span>: <span class="number">4</span>, <span class="attr">HoleLocation</span>: <span class="string">&quot;GRN&quot;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(cors())</span><br><span class="line"></span><br><span class="line">app.use(express.static(<span class="string">&#x27;public&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/api/players&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(&quot;players...&quot;, JSON.stringify(players))</span></span><br><span class="line">    response.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>);</span><br><span class="line">    response.send(<span class="built_in">JSON</span>.stringify(players))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">9000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`app listening on port <span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Notice lines: 2, 25.  Line 2 brings in the CORS support and line 25 enables the middle-ware.  If you comment out line 25 and run the React App from its original directory with npm start, you should see a failure message on the browser console log.  The reason for the failure is that the React app is being served from a server running on localhost port 3000 (by default from create-react-app) and our Express server is running on localhost port 9000.  That is a cross origin violation.  Now uncomment line 25 in the Express server and restart it.  If you refresh the “React App” tab in your browser, you should see the map.</p>
<p>If you consider lines 7-23 of the Express server you will see the in-memory database.  These player definitions are served to callers on line 33 of the Express server.</p>
<p>What does the React App look like?  The original app had the data defined in the code.  We changed that to use javascript fetch in a React lifecycle method.  React’s componentDidMount lifcycle method is called after the component mounts (or, is initialized and attached to the browser DOM). In our new overide of componentDidMount, we fetch our data and place it in state.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">import ShowMap from &#x27;./ShowMap&#x27;</span><br><span class="line"></span><br><span class="line">var golfCourse = require(&#x27;./indy.json&#x27;)</span><br><span class="line"></span><br><span class="line">export default class SimpleExample extends React.Component &#123;</span><br><span class="line"></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props)</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      playerList: null,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // // use javascript fetch to get the graph from the server</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    let url = &#x27;http://localhost:9000/api/players&#x27;</span><br><span class="line"></span><br><span class="line">    // just fetch, no error handling here!</span><br><span class="line">    // when the fetch completes, put the graph in &quot;state&quot;</span><br><span class="line">    fetch(url)</span><br><span class="line">      .then(resp =&gt; &#123; return resp.json() &#125;)</span><br><span class="line">      .then((resp) =&gt; &#123;</span><br><span class="line">        this.setState(&#123; playerList: resp.graph &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    if (this.state.playerList !== null) &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;ShowMap golfCourse=&#123;golfCourse&#125; listOfPlayers=&#123;this.state.playerList&#125; /&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return null</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>We reused a React app and showed how to create an Express server to serve both the React app and content.  Very little changed in the React.  We:</p>
<ul>
<li>Moved the data used to draw the toy soldiers out of the app and into our Express server</li>
<li>We used javascript fetch to get data from the server</li>
<li>We used npm run build to set the React app up as static content</li>
</ul>
<p>On the server side, we:</p>
<ul>
<li>Created a very simple server and set it up to serve static content using the built-in middle-ware “static”.</li>
<li>Created a ‘public’ directory and copied the React app build into it</li>
<li>Created an api (“/api/players”) to serve data to the React app.</li>
</ul>
<p>Express is very flexible.  It has a broad eco-system with many supported middle-ware definitions.  These can be used to create a very wide varity of web serve instances.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/React/" rel="tag"># React</a>
              <a href="/tags/Node/" rel="tag"># Node</a>
              <a href="/tags/Express/" rel="tag"># Express</a>
              <a href="/tags/MongoDB/" rel="tag"># MongoDB</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/10/18/2018-10-18-React-and-Jest/" rel="prev" title="Consuming a REST service with React and testing with Jest">
                  <i class="fa fa-chevron-left"></i> Consuming a REST service with React and testing with Jest
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/09/20/2021-09-20-Docker-with-racket/" rel="next" title="Using Racket in Docker containers">
                  Using Racket in Docker containers <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">James Muguira</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>

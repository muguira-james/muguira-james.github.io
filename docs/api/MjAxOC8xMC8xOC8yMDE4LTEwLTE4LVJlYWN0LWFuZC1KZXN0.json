{"title":"Consuming a REST service with React and testing with Jest","date":"2018-10-18T17:27:12.000Z","date_formatted":{"ll":"Oct 18, 2018","L":"10/18/2018","MM-DD":"10-18"},"link":"2018/10/18/2018-10-18-React-and-Jest","tags":["Jest","React"],"updated":"2022-01-26T02:24:54.559Z","content":"<p>An example of how to consume a REST service and test the page with Jest</p>\n<span id=\"more\"></span>\n<h1 id=\"introduction\">Introduction<a title=\"#introduction\" href=\"#introduction\"></a></h1>\n<p>In a previous article we created a graph REST service.  This article will continue with that effort and show how to use ReactJS to consume the graph.  We will also show how to use Jest to do unit testing on a React application.  The code for this article is on ( <a href=\"https://github.com/muguira-james/GraphsTesting_Java\" target=\"_blank\">github</a>.  Look inside the “BackRiver” repo for the client directory.</p>\n<p>The REST service backend used our Graph ADT.  A graph is composed of vertices and edges.  Our example had a team of 6 people going on a qwest.  The following diagram shows our team:</p>\n<p><img src=\"/images/GraphOfPeople.png\" alt=\"GraphOfPeople.png\" loading=\"lazy\" class=\"φbp\"></p>\n<p>Each person in the team had a [name, a strength attribute and they were carrying something]. In our team there are 6 vertex components, one for each team member. Arrows show the relationships between the team members.  These arrows are called edges.  An example of an edge is the relationship between Jasper and Tom.  Jasper is the beginning vertex in the edge and Tom is the end vertex.  The java code for a vertex looks like this (without getters and setters):</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">public class Vertex &#123;</span><br><span class=\"line\">s''private String _name;</span><br><span class=\"line\">s''private int _strength;</span><br><span class=\"line\">s''private ArrayList&lt;String&gt; _carries = new ArrayList&lt;String&gt;();</span><br><span class=\"line\">s''private int _ID;</span><br><span class=\"line\">s''</span><br><span class=\"line\">s''... (getters/setters removed)</span><br><span class=\"line\"></span><br><span class=\"line\">s''public Vertex(String nm, int initialID) &#123; _ID = initialID; _name = nm; &#125;</span><br><span class=\"line\">s''public Vertex() &#123; _ID = 0; _name = &quot;&quot;; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>The code for an edge looks like this:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">public class Edge &#123;</span><br><span class=\"line\">s''public Vertex beginning;</span><br><span class=\"line\">s''public Vertex end;</span><br><span class=\"line\">s''</span><br><span class=\"line\">s''public Edge(Vertex v, Vertex w) &#123; beginning = v; end = w; &#125;\t</span><br><span class=\"line\">s''</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>A graph is a data structure to hold information and relationships between information.  The nodes, or vertices, hold information and the edges represent the relationships.  Calling the REST service would give us a graph, composed of Vertex objects and a set of Edge objects.</p>\n<h2 id=\"react-app\">React app<a title=\"#react-app\" href=\"#react-app\"></a></h2>\n<p>We’ll use create-react-app to create a framework for our consumer.  We’ll replace the generated code with our components.  Before we code the components we should decide on and define the tests.  This way we know what we are trying to achieve and the list of tests keeps on track.  The create-react-app command has testing included into the generated output. Taking a look at the directory listing of our client you see 3 App* files: App.js, App.css and App.test.js. We’ll focus on App.test.js first.</p>\n<p>One way of testing a React app is to use Jest.  Jest defines a test framework with test setup, running the test and tear down. We are going to do a very simple set of tests:</p>\n<ul>\n<li>Does the app render without failing. This has 2 cases: if the server is running and if not</li>\n<li>Is the app able to gather data from a server</li>\n<li>Does the app render a graph.  This is a check to make sure that specific class names are rendered to the page</li>\n<li>does the app render an adjacency list</li>\n</ul>\n<p>At a high level, the above handles basic unit testing.  The other aspect of the application we have to worry about is connecting to a server and getting data.  For this article we’ll use javascript’s fetch function to retrieve the data.  The retrieved data will be placed in the application state, which drives React’s render mechanism. At a high-level the app flow is:</p>\n<ul>\n<li>mount &amp; get data -&gt; render</li>\n</ul>\n<p>We are going to take advantage of React’s lifecycle methods to accomplish gathering server data.  When the app mounts or creates itself and attaches to the DOM, we’ll use fetch to get our data.</p>\n<h2 id=\"testing-with-jest\">Testing with Jest<a title=\"#testing-with-jest\" href=\"#testing-with-jest\"></a></h2>\n<p>We have the server we wrote from before and we have a few tests. The create-react-app comes pre-wired with Jest setup.  If you are running the app we issue: “npm start”.  If you want to test you issue: “npm test”.  This is some setup that should happen.  You have to write a test file, in our case it is called App.test.js.  The Jest framework knows to look for files that end in *.test.js.  That file starts out like any other React program, we import required libraries.  We are also going to use a test tool called enzyme. Here is our setup file: called enzyme.js:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">import Enzyme, &#123; configure, shallow, mount, render &#125; from &#x27;enzyme&#x27;;</span><br><span class=\"line\">import Adapter from &#x27;enzyme-adapter-react-16&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">configure(&#123; adapter: new Adapter() &#125;);</span><br><span class=\"line\">export &#123; shallow, mount, render &#125;;</span><br><span class=\"line\">export default Enzyme;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>We import required libraries, configure the right adaptor and export or make several parts of the library visible to our test environment.</p>\n<h3 id=\"react-is-fast!\">React is fast!<a title=\"#react-is-fast!\" href=\"#react-is-fast!\"></a></h3>\n<p>One thing to note is that React is very fast. A simple app like this can easily render before the data is ready. Let’s see that in action.  First, turn off the server if you have it running.  Here is a definition of our app that does not handle things properly.  Do an “npm start”</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.state = &#123; <span class=\"attr\">graph</span>: <span class=\"literal\">null</span>, &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// use javascript fetch to get the graph from the server</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> url = <span class=\"string\">&#x27;http://localhost:8080/getQwestTest&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// just fetch, no error handling here!  We&#x27;ll never know if the fetch fails</span></span><br><span class=\"line\">    <span class=\"comment\">// when the fetch completes, put the graph in &quot;state&quot;</span></span><br><span class=\"line\">    fetch(url)</span><br><span class=\"line\">      .then(<span class=\"function\"><span class=\"params\">response</span> =&gt;</span> response.json())</span><br><span class=\"line\">      .then(<span class=\"function\">(<span class=\"params\">resp</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;g-&gt;&quot;</span>, resp.graph)</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setState(&#123; <span class=\"attr\">graph</span>: resp.graph &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// if (this.state.graph === null) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//   return (&lt;p&gt;nothing here yet&lt;/p&gt;)</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">ShowGraph</span> <span class=\"attr\">graph</span>=<span class=\"string\">&#123;this.state.graph&#125;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n<p>In this state, before the fetch can complete, React has tried to render the graph.  The app fails because there is no data associated with “this.state.graph”.  Once we uncomment lines 23-25 the app does not fail.  But since we did not start the server the app simply displays “nothing here yet”.</p>\n<p>This first test shows that the app handles problems gracefully. What does this look like in Jest?  Jest testing is almost another programming language.  We write a file full of tests.  In this case the first test is does the app render without failing.  It looks like:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">describe(&quot;Graph Tests&quot;, () =&gt; &#123;</span><br><span class=\"line\">  test(&#x27;renders without crashing&#x27;, () =&gt; &#123;</span><br><span class=\"line\">    const div = document.createElement(&#x27;div&#x27;);</span><br><span class=\"line\">    ReactDOM.render(&lt;App /&gt;, div);</span><br><span class=\"line\">    ReactDOM.unmountComponentAtNode(div);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Jest uses a “Describe() test(), …, test()” structure.  You describe in a high level way what is tested and then fill in individual tests.  The above code creates a DOM div element and tries to render the app on that div.  If it renders with error the test passes.  The next test is more involved: we define a small graph with a vertex named “Olivia” and a single relationship between Olivia and Tom. The test checks to make sure the output DOM contains a single node of class of graph-vertex.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">test(&#x27;renders a graph vertex&#x27;, () =&gt; &#123;</span><br><span class=\"line\">  const g = &#123; Olivia: [&#123; beginning: &#123; name: &quot;Olivia&quot;, id: 1 &#125;, end: &#123; name: &#x27;Tom&#x27;, id: 2&#125;&#125;]&#125;</span><br><span class=\"line\">  const wrapper = mount((&lt;ShowGraph graph=&#123;g&#125; /&gt;));</span><br><span class=\"line\"></span><br><span class=\"line\">  const t = wrapper.find(&#x27;.graph-vertex&#x27;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  expect((t.children()).length).toBe(1)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>The last test is to render an adjacency list.  We create the list, use Jest mount to render the ShowAdjacent component and test to see if we have the proper class name and text.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">test(&#x27;render adjacent&#x27;, () =&gt; &#123;</span><br><span class=\"line\">  let graph = [ &#123; beginning: &#123;name: &#x27;Olivia&#x27; &#125;, end: &#123;name: &#x27;Ben&#x27;&#125;&#125;, ] </span><br><span class=\"line\">  </span><br><span class=\"line\">  const wrapper = mount(&lt;ShowAdjacent graph=&#123;graph&#125; /&gt;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  const t = wrapper.find(&#x27;.graph-edge&#x27;)</span><br><span class=\"line\">  expect(wrapper.find(&#x27;.graph-edge&#x27;)).toBeDefined()</span><br><span class=\"line\">  expect(t.text()).toBe(&#x27;Ben&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>If the DOM contains the correct elements after the “mount” the test passes.</p>\n<p>To use Jest, instead of starting your app with “npm start” you use “npm test”.  The React app create-react-app included the required functionality into you environment for you.  Your package.json file includes a scripts section with a “test” section that runs “react-scripts test”.  Issuing a “npm test” command at the command prompt will generate the following output:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  RUNS  src/App.test.js</span><br><span class=\"line\"></span><br><span class=\"line\">Test Suites: 0 of 1 total</span><br><span class=\"line\">Tests:       0 total</span><br><span class=\"line\">Snapshots:   0 total</span><br><span class=\"line\">  console.log src/ShowGraph.js:11</span><br><span class=\"line\">    i-&gt; Olivia</span><br><span class=\"line\"></span><br><span class=\"line\">  console.log src/ShowAdjacent.js:6</span><br><span class=\"line\">    t-&gt; &#123; graph: [ &#123; beginning: [Object], end: [Object] &#125; ] &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  console.log src/ShowGraph.js:11</span><br><span class=\"line\">    i-&gt; Olivia</span><br><span class=\"line\"></span><br><span class=\"line\"> PASS  src/App.test.jsAdjacent.js:6</span><br><span class=\"line\">  Graph Tests</span><br><span class=\"line\">    ✓ renders without crashing (104ms)</span><br><span class=\"line\">    ✓ renders a graph vertex (33ms)</span><br><span class=\"line\">    ✓ render adjacent (7ms)</span><br><span class=\"line\"></span><br><span class=\"line\">Test Suites: 1 passed, 1 total</span><br><span class=\"line\">Tests:       3 passed, 3 total</span><br><span class=\"line\">Snapshots:   0 total</span><br><span class=\"line\">Time:        2.411s</span><br><span class=\"line\">Ran all test suites.</span><br><span class=\"line\"></span><br><span class=\"line\">Watch Usage: Press w to show more.</span><br></pre></td></tr></table></figure>\n<p>Jest will continue to try tests as you save your work.  Our setup defines a single test suit composed of specific tests.  As you can see, Jest exposes console.log messages and a debug object. This can be useful to determine what is happening during the test and to provide additional documentation.</p>\n<h1 id=\"conclusion\">Conclusion<a title=\"#conclusion\" href=\"#conclusion\"></a></h1>\n<p>Jest has many verbs for creating tests.  This article just described a very basic testing structure. Testing using frameworks like Jest provide a great way to determine if software is functioning properly. Unit tests provide engineers with a means to ensure components work at a basic level.  As components are joined together to form larger systems, integration testing and behavior testing ensure that the software meets business requirements and delivers proper functionality.</p>\n","prev":{"title":"Using Express to serve a React app","link":"2018/10/26/2018-10-25-Using-Express-to-serve-a-React-JS-app"},"next":{"title":"React UI construction and testing with Storybook","link":"2018/10/14/2018-10-23-React-UI-construction-and-testing-with-storybook"},"plink":"http://muguira-james.github.io/2018/10/18/2018-10-18-React-and-Jest/","toc":[{"id":"introduction","title":"Introduction","index":"1","children":[{"id":"react-app","title":"React app","index":"1.1"},{"id":"testing-with-jest","title":"Testing with Jest","index":"1.2","children":[{"id":"react-is-fast!","title":"React is fast!","index":"1.2.1"}]}]},{"id":"conclusion","title":"Conclusion","index":"2"}],"reading_time":"1660 words in 11 min"}
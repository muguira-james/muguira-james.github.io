{"title":"Cucumber Testing in Java","date":"2018-10-09T17:27:12.000Z","date_formatted":{"ll":"Oct 9, 2018","L":"10/09/2018","MM-DD":"10-09"},"link":"2018/10/09/2018-10-09-A-Cucumber-Testing-in-Java","tags":["Cucumber","Java"],"categories":["Programming"],"updated":"2022-01-26T02:24:54.559Z","content":"<p>Use Cucumber + JUint and Behavior Driven Development</p>\n<span id=\"more\"></span>\n<h2 id=\"introduction\">Introduction<a title=\"#introduction\" href=\"#introduction\"></a></h2>\n<p>Let’s continue with our testing exercise.  The last post described how to add unit test cases to a java class.  It used the various tools and annotations available in JUnit 5.0 to validate the behavior of the java class at a very low level.  This project is going to change it up and work with higher-level test concepts. We are going to be working in Behavior Driven Development (BDD) and creating Feature Files in the Gherkin testing language.</p>\n<p>The sample code for this article can be found on: ( <a href=\"https://github.com/muguira-james/GraphsTesting_Java\" target=\"_blank\">link to github</a>)</p>\n<p>Most of the projects I work on are oriented toward creating software to help a business accomplish some task.  Stakeholders and business analysts interact to solidify the business need and the proper behavior for the new system. These needs are captured and slowly transformed into a specification that engineers can use to create software. In an agile paradigm, these behavior specifications are captured in use cases, which are translated into user stories.  The business analyst and development team translate these user stories into features and finally, into working software.</p>\n<p>A software creation method called BDD uses feature files (written in Gherkin) to bridge the gap from business need specification to software development need specification. Feature files have a particular format:</p>\n<ul>\n<li>Feature – Name of the Feature (or business case)</li>\n<li>Scenario – description of the feature</li>\n<li>Given – specify the initial conditions</li>\n<li>When – specify some action or interaction with the feature</li>\n<li>Then – specify the result of the action or interaction.</li>\n</ul>\n<p>So, the feature file is a mapping of business use cases down to testable software modules.  The business analyst is the bridge between the stakeholders and the developers.  They work with the stakeholders to capture business use cases, translating those to features.  Then, they work with the developers to translate features into tests.</p>\n<p>The rest of the article will describe how to work with Eclipse and JUnit to incorporate BDD into the development process.</p>\n<h2 id=\"our-scenario\">Our Scenario<a title=\"#our-scenario\" href=\"#our-scenario\"></a></h2>\n<p>Using the graph from our previous article, let’s build a story and then a business case that we can use for BDD.  In Figure 1, we see the graph that describes the relationships between 5 characters.  These characters are gathered together to go on a quest for treasure. From the figure, we see that Tom is a central character.  Tom is a very skilled thief and always carries a sack.  Charlie and Emma are both powerful mages.  Olivia is also a mage.  Ben is a human and is currently carrying food.  Finally, Jasper is a swordsman.<br>\n<img src=\"/images/GraphOfPeople.png\" alt=\"GraphOfPeople.png\" loading=\"lazy\"></p>\n<h2 id=\"some-business-rules\">Some Business Rules<a title=\"#some-business-rules\" href=\"#some-business-rules\"></a></h2>\n<p>For a graph representation, we want to capture relationships between our characters.  We would also like to show these relationships.  In our low-level testing, we examined how to verify the correct working of our graph software by testing the operation of adding vertices, adding edges between vertices and asking for a list of neighbors of any vertex.  At a higher level, we are specifying use cases like in figure 2.</p>\n<p><img src=\"/images/Use_Case.png\" alt=\"Use_Case.png\" loading=\"lazy\" class=\"φbp\"></p>\n<p>From our use case diagram, we have 4 cases or features we want the system to implement:</p>\n<ul>\n<li>Create a character,</li>\n<li>Add character to a graph,</li>\n<li>Add an edge or relationship between two characters</li>\n<li>Show the graph.</li>\n</ul>\n<p>Let’s take each of the top 3 items and state them in Gherkin Feature file format.  Show the graph is just a print to the console.</p>\n<h1 id=\"create-a-character\">Create a character<a title=\"#create-a-character\" href=\"#create-a-character\"></a></h1>\n<p>The first test is creating a character.  A character has a name, a relative strength and is carrying something.  The feature file looks like the following:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">Feature: Create a character</span><br><span class=\"line\">Create a character, by filling in a Graph Vertex</span><br><span class=\"line\"></span><br><span class=\"line\">Scenario: Create a character</span><br><span class=\"line\">Given: A Name, a strength and something to carry</span><br><span class=\"line\">When: Add the  name, strength and carried item to a vertex</span><br><span class=\"line\">Then: Test to see if the vertex is initialized properly</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>The first line of the feature file has to say “Feature:”.  We describe the feature and provide a Scenario.  Following those, we provide the Given, When and Then clauses.  These last 3 (Given, When Then) form the basis of the test for this feature.</p>\n<h1 id=\"add-a-character-to-the-graph\">Add a character to the graph<a title=\"#add-a-character-to-the-graph\" href=\"#add-a-character-to-the-graph\"></a></h1>\n<p>The feature file is similar:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">Feature: Add a character to the Graph</span><br><span class=\"line\">Take the vertex containing the character and add it to the graph</span><br><span class=\"line\"></span><br><span class=\"line\">Scenario: add vertex</span><br><span class=\"line\">Given: a filled in Vertex</span><br><span class=\"line\">When: I add it to the Graph</span><br><span class=\"line\">Then: the graph number of Vertex count should increase</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"add-an-edge-or-relationship-between-two-characters\">Add an edge or relationship between two characters<a title=\"#add-an-edge-or-relationship-between-two-characters\" href=\"#add-an-edge-or-relationship-between-two-characters\"></a></h1>\n<p>The Feature file:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">Feature: Add an edge</span><br><span class=\"line\">Connect to characters</span><br><span class=\"line\"></span><br><span class=\"line\">Scenario: fill in an Edge </span><br><span class=\"line\">Given: 2 filled in Vertex, and a complete Edge</span><br><span class=\"line\">When: I add them to the Graph</span><br><span class=\"line\">Then: the Graph should reflect the new relationship</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Although I have not told you how to organize this material in the project yet, if you were to run the project at this point it would do nothing.  The Feature file indicates the tests that we want to run.  It does not define the actual tests.  The last step would be to code the actual tests. The tests are organized as steps (the given step, the when step, the then step).  In this case, we’ll lump all of the tests for each Feature into a single file.  The CreateCharacter step definition file would look like this:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">public class StepDefs_createCharacter &#123;</span><br><span class=\"line\">s''</span><br><span class=\"line\">s''private String name;</span><br><span class=\"line\">s''private int strength;</span><br><span class=\"line\">s''private List&lt;String&gt; carried = new ArrayList&lt;String&gt;();</span><br><span class=\"line\">s''</span><br><span class=\"line\">s''private Vertex v;</span><br><span class=\"line\"></span><br><span class=\"line\">s''@Given(&quot;^A Name, a strength and something to carry$&quot;)</span><br><span class=\"line\">s''public void A_Name_A_Strength_and_something_to_Carry() throws Exception &#123;</span><br><span class=\"line\">s''s''System.out.println(&quot;given: A Name, a strength and something to carry&quot;);</span><br><span class=\"line\">s''s''</span><br><span class=\"line\">s''s''name = &quot;Jasper&quot;;</span><br><span class=\"line\">s''s''strength = 11;</span><br><span class=\"line\">s''s''carried.add(&quot;sword&quot;);</span><br><span class=\"line\">s''&#125;</span><br><span class=\"line\">s''</span><br><span class=\"line\">s''@When(&quot;^Add the  name, strength and carried item to a vertex$&quot;)</span><br><span class=\"line\">s''public void Add_the_name_strength_and_carried_item_to_a_vertex() throws Exception &#123;</span><br><span class=\"line\">s''s''System.out.println(&quot;when: Add the  name, strength and carried item to a vertex&quot;);</span><br><span class=\"line\">s''s''</span><br><span class=\"line\">s''s''v = new Vertex(name, 0);</span><br><span class=\"line\">s''s''v.setStrength(11);</span><br><span class=\"line\">s''s''v.addToStuffCarried(&quot;sword&quot;);</span><br><span class=\"line\">s''&#125;</span><br><span class=\"line\">s''</span><br><span class=\"line\">s''@Then(&quot;^Test to see if the vertex is initialized properly$&quot;)</span><br><span class=\"line\">s''public void Test_to_see_if_the_vertex_is_initialized_properly() throws Exception &#123;</span><br><span class=\"line\">s''s''System.out.println(&quot;given: Test to see if the vertex is initialized properly&quot;);</span><br><span class=\"line\">s''s''</span><br><span class=\"line\">s''s''</span><br><span class=\"line\">s''s''String n = v.name();</span><br><span class=\"line\">s''s''int strength = v.strength();</span><br><span class=\"line\">s''s''ArrayList&lt;String&gt; items = v.getCarriedStuff();</span><br><span class=\"line\">s''s''</span><br><span class=\"line\">s''s''assertEquals(&quot;Japser&quot;, n);</span><br><span class=\"line\">s''s''assertEquals(11, strength);</span><br><span class=\"line\">s''s''assertEquals(&quot;sword&quot;, items.get(0));</span><br><span class=\"line\">s''s''</span><br><span class=\"line\">s''s''</span><br><span class=\"line\">s''&#125;</span><br><span class=\"line\">s''</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>The “step definition” carries out the actual test.  I sets up the variables: name and strength. It then creates a Vertex with the data.  Finally, this step definition checks to see that the Vertex is organized correctly.  Each of the other step definition files are similar in structure.</p>\n<h1 id=\"project-structure\">Project Structure<a title=\"#project-structure\" href=\"#project-structure\"></a></h1>\n<p>In order to run the system with all of the tests you need to devise a structure.  You can use Eclipse to facilitate this.  I will choose Gradle since it aligns with the Continuous Integration and Continuous Deployment (CI/CD) used by most project teams.  Figure 3 gives you an idea of how to structure the project.  The main idea is to create 3 parts: a resource directory to contain the feature file; and 2 test packages to contain the TestRunner that corresponds to the feature specification and step definitions.</p>\n<p><img src=\"/images/ProjectStructure.png\" alt=\"ProjectStructure\" loading=\"lazy\" class=\"φbp\"></p>\n<p>Let’s examine the feature specification for TestRunner_createCharacter.  The test runner is a part of JUnit.  I created one TestRunner for each Feature file definition in the resource directory.  Each TestRunner is tied to its Feature definition by the annotation “@CucumberOptions”.  Furthermore, the TestRunner is tied to the step definition in the same annotation.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">package testRunners;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.junit.runner.RunWith;</span><br><span class=\"line\">import cucumber.api.CucumberOptions;</span><br><span class=\"line\">import cucumber.api.PendingException;</span><br><span class=\"line\">import cucumber.api.junit.Cucumber;</span><br><span class=\"line\"></span><br><span class=\"line\">@RunWith(Cucumber.class)</span><br><span class=\"line\">@CucumberOptions(features=&quot;resources/features&quot;, glue=&quot;src/test/java/stepDefinitions&quot;)</span><br><span class=\"line\">public class TestRunner_createCharacter &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>This project was created as a gradle project in Eclipse.  Once this infrastructure is in place you can use the “Gradle Tasks” tab in Console output area to run the all the tests, just double click on the word “test” (see figure 3).  If you want to run a single test right click on the specific test runner file in the Package Explorer and select “Run As-&gt;Gradle Test”.</p>\n<p><img src=\"/images/GradleTasksTab.png\" alt=\"GradleTasksTab.png\" loading=\"lazy\" class=\"φbp\"></p>\n<p>After the task has run you should see the following (see figure 4)</p>\n<p><img src=\"/images/SuccessfulGradleRun.png\" alt=\"SuccessfulGradleRun.png\" loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"conclusion\">Conclusion<a title=\"#conclusion\" href=\"#conclusion\"></a></h2>\n<p>This article introduced you to BDD.  We modeled the business problem as a UML use case, and then transformed that diagram into a BDD Feature File in the Gherkin language.  We demonstrated a possible way to organize the project so that gradle could automatically compile and run the tests.</p>\n<p>.</p>\n","prev":{"title":"Create a REST service with Spring","link":"2018/10/14/2019-10-14-A-Create-a-REST-service-with-Spring"},"next":{"title":"JUnit Testing in java","link":"2018/10/06/2018-10-06-JUnit-Testing-in-Java"},"plink":"http://muguira-james.github.io/2018/10/09/2018-10-09-A-Cucumber-Testing-in-Java/","toc":[{"id":"introduction","title":"Introduction","index":"1"},{"id":"our-scenario","title":"Our Scenario","index":"2"},{"id":"some-business-rules","title":"Some Business Rules","index":"3"}],"reading_time":"1565 words in 10 min"}